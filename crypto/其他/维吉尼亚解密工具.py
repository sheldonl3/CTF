'''
这是维吉尼亚？不会解没关系找个脚本吧~（提示密钥长度有点大哦，爆破可不行）
答案提示：解密后首先你能看得懂，答案为flagis后面的内容，提交flag{xxxx}

pfuchjgeldndhisjoyilsbtfwcgxvfgzqhwfsnjywdpxnekfzshhxcmiozaxfrcnpmfqfwtpxsyaitzyjteyhwmayhwtbfwcfwintpuhfmebbcvprckqpmahpqpapziwwotjscqpzzdffhcifbovdttcoxvfbwhejifydotdljbazxszysfzcefxondidpesxwowsrasocaawnijmbmwleuyglcgyjapvjgppebkrzuhbxocrspfwpdbbhipzuunijiwyeysrqfiopbbitasjquejjmsoenigkvgvavjpinjbilfyobpfnhdbshpebqdiepfzksipxshpaxpdwhtfxwbnjrssmoiwbgefmnuwcxwsbivblllovfzwdpxnekhmgfjholpzycpiezmfuhcntoskruoplsjskzevmmasuvevfyqovsjglpnrqnhyculsucsotuwwrquwoptfejfswushwplfwgwudwnffwsoxdpobuserhbfkryyqjtptbtlphsswumsyjpvmrvxsterjltfrarhumvlwiwnfytashftttlfwcsttvmamuvbfsuagfdwxsudntkpfndlusrxttbavfuswuibokfdkpvrguffxwqdffyylwgmeamoxnijdlejshaythwbfjbdvmqzseioehnbiowavuwuyvijfwgortjbzjnubhfrstwohkqiokwsmbqiudgldhsrvyqjotwjyijuizqtnfhdlstzvflaruniujpowjlhnbxyyytovfcoiqlsbhfpszacsjzfmkrzynurhleinsjsewiwcwwuffptwwbhbpszpsuzsstdifytzsbazyrvbvsfexhhimjhpfrgitpewowvjlhfdkvrysgppogogoyvilfffexxjbpzswfkfdfpagtncxnwgcxfcmhsmmevszcutroncljmoeitnesjbuezqnocepwomuninlslebswuofqstxfwgeotvmkfdguvwomvfranimulmrlcyyzqsqiokcrwvhqatswdemjhuiftutuhaqsmtgkazmwclxgmpfqstxfwgkgtvmkfdguvwomkjlhfsnbqijhfxehhvqytxogimjhpfrsvcjuvfvsehmvserucuygkyjyswtbhcolyecstkpiebmxuqsuxssutuhaossjygdvkynhsrxbbyfoajxukoeotoolhpjwojhieyszontlahvcnnyvennfhclfxhdfmsasblsdlosgquenxvymkxpljutamsmhujfsidywkootsezwcxqghicmioxvyftgewzyrlizinujffssjlwnpzmtijtjvgursutavczunilsscnajlxujxdamsjrsjtvttijtjvgursutavczuniglqnhlwsjisjfoamfbzdozcmofcgxvfbwhejifytwywywurlzgixofaepzqgenizirmdtpvhikgfckrrffzxaygztojdpujshebuyvateqwneqsuxssutuhaossjyyolvnhlqsxnfwotvpbswodqwlvrbumgyjsdruthcptmowwlfvwaixcduomolhkuhszoxnbulsugpmeysflfytkuvcnnycxbfpsyjjsreoghpeqtgjxwptcgtdiqcqninawrtsjhxysnbtlbyfkxabltijbvwwomhieyszontwhhtylhxhlyqqoirujlpgofmxbrdmiwoxcxlbvcgmkqkulbejndlysysxxmfdlfafaiohcmyaogkiiylwmunibpjmtwqomhujltpfyhasnsftjsfpasgxcnlaqchuniyphbeyysbnynglsdfhaeibkomzaoxhiaguioxvytkgkuvjlhnbxyyyzexujfwxobleskimwsskbjtulomugoauhiszjgwcpscfqzjbpjrsaovqzjosunsteoasyussnuahgzttwjsnbgainqdjebrozbwulazcvplalsuszmwtsfoujorxgjslxijqdbrawffcwtxsoisjnplwmtvspdzccobowwsjotiekcnuhsjljxgpjgpaztleosgjtiehemoofdtsndreeskfefnraobggpvpfjwotdisrramoplyslsgiigrsriuwojruwteynguibdkhiapmbyhriyaesthqsrntnghsvqrxfibkaqfpmicgjfbweruutorcswmtytyiuuyvetsjgaotawmfshbrrzkhjfaiznigxeuwpeybowuhwsaxfwonuigbtifboskxnsowdmzyunihvnylfaopffdheinxkeuhjippzfbvcvtrnewrrnikqayaxihsgyhtyfiofxhdfudxesxisjodkcgtdiwgqkraajubsjtsfjfuesgrmpsesaaoipvxogkkttnemamkeizknehqwrnpyvemossntabktvffzmhixcxmuwsfgjssusgoulhlyufzlksfgocyhpeuwwdozjtuttniogbthwzafilhzsmfyctlfjonuhobhpzgbrrvtyoosrdfbtxohjynvywgyegmmixmsjjhsirumscynautuhapwnurisvjfdhrcraumssxbqyobnrorpbtbqwmooswexvnikgkbfnllxgmhejgcvjgoxmetwrnxcgxvfobteyxguojjhpwmtojbmzfjztlfufatebkepkhiiomswhhpckbplsntwxuznblcttknmnfuabnrbhfgffehiutuhwxihjbinzsflvasabjhvbibwgwodgcsufwowitggjtbpcuuyenvmhdbxwruojhevonhupfptitxoohhikbnybvwyojadlfxaypbimttjevtufabdguyfdstebensbvarohekenazmelrhsxxjzlmormopuzinefptsfcohtpkaslmooaazyfvwaszbgslswjrijshzetxhiibjutuejxvcoqaeazfoulwrapmkoymiwypuzldfxqsmpfzvfsagchdktppghsjtipxjrdritxilpndipfwomphighjshmjcomwkmmflhsrausrkixinbiftvitjyajkvuhsuhaqwlsuvkmessvzzemndgoymngpieaqrstfpjhikwoferwnfmszvesfynsrxczhixjxhkpmikhgtfncguxsogplwmjtoquvyramsayjlvtsgyvatpzmnetisstunstermgcptwwdghdlwtyftjferjymdbshikfsdpwgfygjojstgzkrppjysvzzpcljhhitjgsfehuosswokgplgqreruqiogdpwhjvdkmnirmwlpqsdfafbibromsbfgbefaiznikgdhjgomjlmmujbcijshdjsgxoubvjgvxggdraehyelsnazybsngwigxcuptqwgfmwvejfatsvbvdzmuhsuslvelfxsvfpwisgsdmoyvafxecitnhfwsoyspfiifyuxejxmcllcwwnfsqexifheoeutedyazxomkbusewvivrhxlahchuofffttdvbbwjhagqnhqsulsgrohiogchhxepbdutptbcivlstxingbmau
'''

#替换主函数c的密文
def get_IC(cipher):
    count = [0 for i in range(26)]
    L = len(cipher)
    if(L == 1):
        return 0.0
    IC = 0.0
    for i in range(len(cipher)):
        count[ord(cipher[i]) - ord('a')] += 1
    for i in range(26):
        IC += (count[i] * (count[i] - 1)) / (L * (L - 1))
    return IC

def get_key_len(c):
    low = 10000
    kl = 0
    add = 0.0
    #for i in range(1, "密钥长度最大值"):
    for i in range(1,50):
        for j in range(0,i):
            c1 = c[j::i]
            add += get_IC(c1)
        add /= i
        print("add = ",add," i = ",i)
        if(abs(low - 0.065546) > abs(add - 0.065546)):
            low = add
            kl = i
        add = 0
    return kl


def get_key(c):#计算key
    all_key = "abcdefghijklmnopqrstuvwxyz"
    prob = [0.08167,0.01492,0.02782,0.04253,0.12705,0.02228,0.02015,0.06094,0.06996,0.00153,0.00772,0.04025,0.02406,0.06749,0.07507,0.01929,0.0009,0.05987,0.06327,0.09056,0.02758,0.00978,0.02360,0.0015,0.01974,0.00074]
    counter = [0 for _ in range(26)]
    len1 = len(c)
    for i in range(len1):
        temp = ord(c[i]) - ord('a')
        counter[temp] += 1
    low = 10000
    add = 0.0
    for i in range(26):
        for j in range(26):
            add += (counter[(j+i)%26]/len1 - prob[j])**2
        # print("i = ",i,"Sum of Squared Residuals = ",add)
        if(add < low):
            low = add
            sign = i
        add = 0.0
    return all_key[sign]


if __name__ == "__main__":
    c = "pfuchjgeldndhisjoyilsbtfwcgxvfgzqhwfsnjywdpxnekfzshhxcmiozaxfrcnpmfqfwtpxsyaitzyjteyhwmayhwtbfwcfwintpuhfmebbcvprckqpmahpqpapziwwotjscqpzzdffhcifbovdttcoxvfbwhejifydotdljbazxszysfzcefxondidpesxwowsrasocaawnijmbmwleuyglcgyjapvjgppebkrzuhbxocrspfwpdbbhipzuunijiwyeysrqfiopbbitasjquejjmsoenigkvgvavjpinjbilfyobpfnhdbshpebqdiepfzksipxshpaxpdwhtfxwbnjrssmoiwbgefmnuwcxwsbivblllovfzwdpxnekhmgfjholpzycpiezmfuhcntoskruoplsjskzevmmasuvevfyqovsjglpnrqnhyculsucsotuwwrquwoptfejfswushwplfwgwudwnffwsoxdpobuserhbfkryyqjtptbtlphsswumsyjpvmrvxsterjltfrarhumvlwiwnfytashftttlfwcsttvmamuvbfsuagfdwxsudntkpfndlusrxttbavfuswuibokfdkpvrguffxwqdffyylwgmeamoxnijdlejshaythwbfjbdvmqzseioehnbiowavuwuyvijfwgortjbzjnubhfrstwohkqiokwsmbqiudgldhsrvyqjotwjyijuizqtnfhdlstzvflaruniujpowjlhnbxyyytovfcoiqlsbhfpszacsjzfmkrzynurhleinsjsewiwcwwuffptwwbhbpszpsuzsstdifytzsbazyrvbvsfexhhimjhpfrgitpewowvjlhfdkvrysgppogogoyvilfffexxjbpzswfkfdfpagtncxnwgcxfcmhsmmevszcutroncljmoeitnesjbuezqnocepwomuninlslebswuofqstxfwgeotvmkfdguvwomvfranimulmrlcyyzqsqiokcrwvhqatswdemjhuiftutuhaqsmtgkazmwclxgmpfqstxfwgkgtvmkfdguvwomkjlhfsnbqijhfxehhvqytxogimjhpfrsvcjuvfvsehmvserucuygkyjyswtbhcolyecstkpiebmxuqsuxssutuhaossjygdvkynhsrxbbyfoajxukoeotoolhpjwojhieyszontlahvcnnyvennfhclfxhdfmsasblsdlosgquenxvymkxpljutamsmhujfsidywkootsezwcxqghicmioxvyftgewzyrlizinujffssjlwnpzmtijtjvgursutavczunilsscnajlxujxdamsjrsjtvttijtjvgursutavczuniglqnhlwsjisjfoamfbzdozcmofcgxvfbwhejifytwywywurlzgixofaepzqgenizirmdtpvhikgfckrrffzxaygztojdpujshebuyvateqwneqsuxssutuhaossjyyolvnhlqsxnfwotvpbswodqwlvrbumgyjsdruthcptmowwlfvwaixcduomolhkuhszoxnbulsugpmeysflfytkuvcnnycxbfpsyjjsreoghpeqtgjxwptcgtdiqcqninawrtsjhxysnbtlbyfkxabltijbvwwomhieyszontwhhtylhxhlyqqoirujlpgofmxbrdmiwoxcxlbvcgmkqkulbejndlysysxxmfdlfafaiohcmyaogkiiylwmunibpjmtwqomhujltpfyhasnsftjsfpasgxcnlaqchuniyphbeyysbnynglsdfhaeibkomzaoxhiaguioxvytkgkuvjlhnbxyyyzexujfwxobleskimwsskbjtulomugoauhiszjgwcpscfqzjbpjrsaovqzjosunsteoasyussnuahgzttwjsnbgainqdjebrozbwulazcvplalsuszmwtsfoujorxgjslxijqdbrawffcwtxsoisjnplwmtvspdzccobowwsjotiekcnuhsjljxgpjgpaztleosgjtiehemoofdtsndreeskfefnraobggpvpfjwotdisrramoplyslsgiigrsriuwojruwteynguibdkhiapmbyhriyaesthqsrntnghsvqrxfibkaqfpmicgjfbweruutorcswmtytyiuuyvetsjgaotawmfshbrrzkhjfaiznigxeuwpeybowuhwsaxfwonuigbtifboskxnsowdmzyunihvnylfaopffdheinxkeuhjippzfbvcvtrnewrrnikqayaxihsgyhtyfiofxhdfudxesxisjodkcgtdiwgqkraajubsjtsfjfuesgrmpsesaaoipvxogkkttnemamkeizknehqwrnpyvemossntabktvffzmhixcxmuwsfgjssusgoulhlyufzlksfgocyhpeuwwdozjtuttniogbthwzafilhzsmfyctlfjonuhobhpzgbrrvtyoosrdfbtxohjynvywgyegmmixmsjjhsirumscynautuhapwnurisvjfdhrcraumssxbqyobnrorpbtbqwmooswexvnikgkbfnllxgmhejgcvjgoxmetwrnxcgxvfobteyxguojjhpwmtojbmzfjztlfufatebkepkhiiomswhhpckbplsntwxuznblcttknmnfuabnrbhfgffehiutuhwxihjbinzsflvasabjhvbibwgwodgcsufwowitggjtbpcuuyenvmhdbxwruojhevonhupfptitxoohhikbnybvwyojadlfxaypbimttjevtufabdguyfdstebensbvarohekenazmelrhsxxjzlmormopuzinefptsfcohtpkaslmooaazyfvwaszbgslswjrijshzetxhiibjutuejxvcoqaeazfoulwrapmkoymiwypuzldfxqsmpfzvfsagchdktppghsjtipxjrdritxilpndipfwomphighjshmjcomwkmmflhsrausrkixinbiftvitjyajkvuhsuhaqwlsuvkmessvzzemndgoymngpieaqrstfpjhikwoferwnfmszvesfynsrxczhixjxhkpmikhgtfncguxsogplwmjtoquvyramsayjlvtsgyvatpzmnetisstunstermgcptwwdghdlwtyftjferjymdbshikfsdpwgfygjojstgzkrppjysvzzpcljhhitjgsfehuosswokgplgqreruqiogdpwhjvdkmnirmwlpqsdfafbibromsbfgbefaiznikgdhjgomjlmmujbcijshdjsgxoubvjgvxggdraehyelsnazybsngwigxcuptqwgfmwvejfatsvbvdzmuhsuslvelfxsvfpwisgsdmoyvafxecitnhfwsoyspfiifyuxejxmcllcwwnfsqexifheoeutedyazxomkbusewvivrhxlahchuofffttdvbbwjhagqnhqsulsgrohiogchhxepbdutptbcivlstxingbmau"
    c = c.lower()
    kylen = get_key_len(c)
    print("len = ",kylen)
    key = ""
    for i in range(0,kylen):
        ct = c[i::kylen]
        key += get_key(ct)
    print("key = ",key)

    m = ""
    for i in range(len(c)):
        a = (ord(c[i]) - ord(key[i % kylen]) + 26) % 26 + ord('a')  
        m += chr(a)
    print("message = ", m)    #flag{congratulationyougetthisflag}
