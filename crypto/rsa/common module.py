# import libnum
# import gmpy2
# from flag import flag
# p=libnum.generate_prime(1024)
# q=libnum.generate_prime(1024)
# e1=2333
# e2=23333
# m=libnum.s2n(flag)
# n=p*q
# c1=pow(m,e1,n)
# c2=pow(m,e2,n)
# print("n1:",n)
# print("e1:",e1)
# print("c1:",c1)
# print("n2:",n)
# print("e2:",e2)
# print("c2:",c2)

# n1=15458566829456374871668265085919396153087770301939114860552611597602633058150672349664760824820070838032713179101096956198269084488936817309447458061242323740256183434175429715769893538254759877237083660138245687815464953299932426579405086169714107461888094638294134268457258450192009724660094989372504083970776017833424563819729213185477544684767511789538670862702705159902256478587347570266368976067260457686959456946575605162935645426834652385896887583866452994003515240139027493776573171495985362870832819573741040385283803253702121158757771132074050039416990667163792231176511123819970242008749127496563727614807
# e1=2333
# c1=8286457832668273707548153265042083967936616911455209798891477857250651499691879786753749624915166202346214199270689149681110608678000336652101059326836982534170449683255588565245466580874167488838429256657696353307714547273566573112310243804604674948137210937118890218151778295544218356417735980499574950490526668256430211743615443145847129301954325804510022241333911960520085048344890912822387030329794761877086710055653688528162569567979683370552627745668959280457759259718353530011428034709261480595213540062848047870053497590495572176002279466071921083266476724090700276529948351176428597601602371643007201911539
# n2=15458566829456374871668265085919396153087770301939114860552611597602633058150672349664760824820070838032713179101096956198269084488936817309447458061242323740256183434175429715769893538254759877237083660138245687815464953299932426579405086169714107461888094638294134268457258450192009724660094989372504083970776017833424563819729213185477544684767511789538670862702705159902256478587347570266368976067260457686959456946575605162935645426834652385896887583866452994003515240139027493776573171495985362870832819573741040385283803253702121158757771132074050039416990667163792231176511123819970242008749127496563727614807
# e2=23333
# c2=3475848379816151480285870153147001178586542744253622004797450971979908775661336934163651941804448172821116405615751262439666064599331433687616345647574168906127759696233954813587470931173628355143916680969827519148522957882262930548299293073386659486938383730840177545906012852384815360601502203416544918812909036394266667578630715652667616553094049403609492703583205183112619678573572034105253480688056467695065723996421576406184186197393948436502844071318410706379427104690142928009375509926248279823720003855587278295862409483520223764945775383751236502158084075223606458290014502585333237727283069681008554268262


#共模攻击
import gmpy2
import libnum

def common_modulus_attack(n, e1, c1, e2, c2):
    # 扩展欧几里得求系数
    g, a, b = gmpy2.gcdext(e1, e2)
    print(f"gcd({e1}, {e2}) = {g}")
    print(f"a = {a}, b = {b}")
    
    if a < 0:
        c1 = gmpy2.invert(c1, n)
        a = -a
    if b < 0:
        c2 = gmpy2.invert(c2, n)
        b = -b
    
    m = (pow(c1, a, n) * pow(c2, b, n)) % n
    return m

if __name__ == "__main__":
    # 从题目输出复制数据
    n1=15458566829456374871668265085919396153087770301939114860552611597602633058150672349664760824820070838032713179101096956198269084488936817309447458061242323740256183434175429715769893538254759877237083660138245687815464953299932426579405086169714107461888094638294134268457258450192009724660094989372504083970776017833424563819729213185477544684767511789538670862702705159902256478587347570266368976067260457686959456946575605162935645426834652385896887583866452994003515240139027493776573171495985362870832819573741040385283803253702121158757771132074050039416990667163792231176511123819970242008749127496563727614807
    e1=2333
    c1=8286457832668273707548153265042083967936616911455209798891477857250651499691879786753749624915166202346214199270689149681110608678000336652101059326836982534170449683255588565245466580874167488838429256657696353307714547273566573112310243804604674948137210937118890218151778295544218356417735980499574950490526668256430211743615443145847129301954325804510022241333911960520085048344890912822387030329794761877086710055653688528162569567979683370552627745668959280457759259718353530011428034709261480595213540062848047870053497590495572176002279466071921083266476724090700276529948351176428597601602371643007201911539
    n2=15458566829456374871668265085919396153087770301939114860552611597602633058150672349664760824820070838032713179101096956198269084488936817309447458061242323740256183434175429715769893538254759877237083660138245687815464953299932426579405086169714107461888094638294134268457258450192009724660094989372504083970776017833424563819729213185477544684767511789538670862702705159902256478587347570266368976067260457686959456946575605162935645426834652385896887583866452994003515240139027493776573171495985362870832819573741040385283803253702121158757771132074050039416990667163792231176511123819970242008749127496563727614807
    e2=23333
    c2=3475848379816151480285870153147001178586542744253622004797450971979908775661336934163651941804448172821116405615751262439666064599331433687616345647574168906127759696233954813587470931173628355143916680969827519148522957882262930548299293073386659486938383730840177545906012852384815360601502203416544918812909036394266667578630715652667616553094049403609492703583205183112619678573572034105253480688056467695065723996421576406184186197393948436502844071318410706379427104690142928009375509926248279823720003855587278295862409483520223764945775383751236502158084075223606458290014502585333237727283069681008554268262


    m = common_modulus_attack(n2, e1, c1, e2, c2)
    print(f"Recovered m = {m}")
    
    flag = libnum.n2s(int(m))
    print("Flag:", flag) #SKSEC{5aae4cc6-4e8a-11ef-b321-743af4fbda8d}