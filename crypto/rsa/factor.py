# import gmpy2
# from Crypto.Util.number import *
# from secret import flag

# m=bytes_to_long(flag.encode())
# p=getPrime(1024)
# q=gmpy2.next_prime(p)
# e=65537
# n=p*q
# c=pow(m,e,n)
# print("n=",n)
# print("c=",c)
#######################重要  ！！！！########################




'''方法1 deepseek'''
import gmpy2
from Crypto.Util.number import *

e = 65537
n= 9720005952007953929334912390596029503246076180420212287636104771090495028292407006276974237341066235949512858174768532022243591439252002060669541838088125455618387261585297883870724911280526037605386518126331328586895662229044133645481929896860814196214296479267612271463470383605652407973773986987833180068881753409917883120219317196174483456946024440783885513956634957726945767830129362712273880906164060804154828403341302517615942277576239745942477248290165200343641544872777604671210075971960413688339635582403132172563812244498174540553514986570969798780811799608418792305230155732840573234935331004744248355631
c= 3675831034587202483276502556360906770240756812524198879378994964380062734299380571972833817191183101123240086684584012866358065001461632615005557196191172372915983296600833999788503019759135897631524157443589806066488329825205138033904882468360671536487008167168199315333663753792002579233822728671053249416006036068381759814527585701468697980456216349712259215972366750190066353910116701984857020740532611365577246296102309866623118611618364579709703299033843891679720803755253652812598303712889511735085442937461546510102668235392053115639266826702960394248528160823912886093725983324747515519555227721162571435922


def fermat_factor(n):
    """使用费马分解法分解n（p和q很接近时有效）"""
    a = gmpy2.isqrt(n) + 1
    b2 = a*a - n
    while not gmpy2.is_square(b2):
        a += 1
        b2 = a*a - n
    b = gmpy2.isqrt(b2)
    return int(a - b), int(a + b)

def decrypt_rsa(n, c, e=65537):
    p, q = fermat_factor(n)
    print(f"p = {p}")
    print(f"q = {q}")
    
    phi = (p-1)*(q-1)
    d = gmpy2.invert(e, phi)
    m = pow(c, d, n)
    return long_to_bytes(m)

if __name__ == "__main__":
    flag = decrypt_rsa(n, c)
    print("Flag:", flag)   #SKSEC{5e69ffe2-4e88-11ef-8561-743af4fbda8d}



'''
方法2
qp相差大时
使用yafu-Win32.exe factor(）分解出 q p,之后进行same_prime的步骤
'''
# from Crypto.Util.number import *
# e = 65537
# n= 9720005952007953929334912390596029503246076180420212287636104771090495028292407006276974237341066235949512858174768532022243591439252002060669541838088125455618387261585297883870724911280526037605386518126331328586895662229044133645481929896860814196214296479267612271463470383605652407973773986987833180068881753409917883120219317196174483456946024440783885513956634957726945767830129362712273880906164060804154828403341302517615942277576239745942477248290165200343641544872777604671210075971960413688339635582403132172563812244498174540553514986570969798780811799608418792305230155732840573234935331004744248355631
# c= 3675831034587202483276502556360906770240756812524198879378994964380062734299380571972833817191183101123240086684584012866358065001461632615005557196191172372915983296600833999788503019759135897631524157443589806066488329825205138033904882468360671536487008167168199315333663753792002579233822728671053249416006036068381759814527585701468697980456216349712259215972366750190066353910116701984857020740532611365577246296102309866623118611618364579709703299033843891679720803755253652812598303712889511735085442937461546510102668235392053115639266826702960394248528160823912886093725983324747515519555227721162571435922

# #使用yafu-Win32.exe factor(n）分解出 q p
# p = 98590090536564342528917555086451718367793646096790766959779531164580359553639083458634714368381748806309215498999619150956511094835722906855382254712140881361958324635593843390375070863193457761488586824575436760292375597317451236977147877882192749879349794209386627333026912986209674704156604212112788546893
# q = 98590090536564342528917555086451718367793646096790766959779531164580359553639083458634714368381748806309215498999619150956511094835722906855382254712140881361958324635593843390375070863193457761488586824575436760292375597317451236977147877882192749879349794209386627333026912986209674704156604212112788546667

# phi = (p-1)*(q-1)
# d = inverse(e,phi)    #私钥
# m = pow(c,d,n)
# flag = long_to_bytes(m)  #整数转化为字节流
# print(flag)